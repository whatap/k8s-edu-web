---
sidebar_position: 3
authors: irostub
---
# 2ë¶€: ì¿ ë²„ë„¤í‹°ìŠ¤ ëª¨ë‹ˆí„°ë§ ì‹¤ìŠµ


## ì¿ ë²„ë„¤í‹°ìŠ¤ ëª¨ë‹ˆí„°ë§ì´ í•„ìš”í•œ ì´ìœ 
ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ì•ˆì—ëŠ” ë§ì€ ì„œë¹„ìŠ¤ê°€ ë…ë¦½ì ìœ¼ë¡œ ìš´ì˜ë˜ê¸° ë•Œë¬¸ì—, ì´ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ê³  ë¡œê·¸ë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” í´ëŸ¬ìŠ¤í„°ì˜ ìƒíƒœì™€ ê´€ë¦¬ë¥¼ ìœ„í•œ ê¸°ë³¸ì ì¸ ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì¿ ë²„ë„¤í‹°ìŠ¤ ë§Œìœ¼ë¡œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±ì‹œí‚¤ê¸°ëŠ” ì–´ë µìŠµë‹ˆë‹¤.

- ì‹œê°í™”ì™€ ëŒ€ì‹œë³´ë“œ
- ì‹¤ì‹œê°„ íŠ¸ë˜í”½ ëª¨ë‹ˆí„°ë§, ë¡œê·¸ ë¶„ì„, íŠ¸ë ˆì´ì‹±ê³¼ ê°™ì€ ê³ ê¸‰ ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥
- ì•Œë¦¼ê³¼ ê²½ê³ 
- ëŒ€ê·œëª¨ ì• í”Œë¦¬ì¼€ì´ì…˜ í™˜ê²½ì„ ìœ„í•œ ë¡œê·¸ ê´€ë¦¬

ë”°ë¼ì„œ ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ì´ëŸ° ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•  ìˆ˜ ìˆëŠ” ëª¨ë‹ˆí„°ë§ ì†”ë£¨ì…˜ì„ ë„ì…í•´ ë³´ë‹¤ ì²´ê³„ì ì´ê³  ì „ë¬¸ì ì¸ ëª¨ë‹ˆí„°ë§ í™˜ê²½ì„ êµ¬ì¶•í•©ë‹ˆë‹¤.

:::info ì´ë²ˆ ì‹¤ìŠµì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ í™œë™ì„ í•©ë‹ˆë‹¤.

1. ëª…ë ¹ì–´ ì—†ì´ ì‹œê°ì ìœ¼ë¡œ ì´ì „ì— ìƒì„±í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚´í´ë´…ë‹ˆë‹¤.
2. ì‹¤ì œ java ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•©ë‹ˆë‹¤.
3. ë‹¤ì–‘í•œ ë¶€í•˜ ìƒí™©ì„ ë§Œë“¤ì–´ë³´ê³ , ì´ë¥¼ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.
:::

## ëª¨ë‹ˆí„°ë§ ì„¤ì¹˜í•˜ê¸°

### íšŒì› ê°€ì… ë° ë¡œê·¸ì¸

ì™€íƒ­ ì„œë¹„ìŠ¤ì— ì ‘ì†í•´ íšŒì› ê°€ì… ë° ë¡œê·¸ì¸ì„ ì§„í–‰í•˜ì„¸ìš”. 

[WhaTap](https://service.whatap.io/account/login)

### ê³„ì • ì–¸ì–´ ì„¤ì • ë³€ê²½

í•œêµ­ì–´ ì§€ì›ì„ ë¹¼ë†“ì„ ìˆœ ì—†ê² ì£ . ì™€íƒ­ ëª¨ë‹ˆí„°ë§ ê³„ì •ì˜ ì–¸ì–´ ì„¤ì •ì„ ë³€ê²½í•©ë‹ˆë‹¤.
![img.png](img.png)

### ì¿ ë²„ë„¤í‹°ìŠ¤ ëª¨ë‹ˆí„°ë§ í”„ë¡œì íŠ¸ ìƒì„±

ëª¨ë‹ˆí„°ë§ì„ ì„¤ì¹˜í•˜ê¸° ì „ì— ì™€íƒ­ ì„œë¹„ìŠ¤ì—ì„œ ì¿ ë²„ë„¤í‹°ìŠ¤ ëª¨ë‹ˆí„°ë§ì„ ìœ„í•œ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

1. ìƒí’ˆ ì„ íƒ ë‹¨ê³„ì—ì„œ Kubernetesë¥¼ ì„ íƒí•˜ì„¸ìš”.
![img_1.png](img_1.png)
2. í”„ë¡œì íŠ¸ ìƒì„± ë‹¨ê³„ì—ì„œ í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
![img_2.png](img_2.png)
>   í”„ë¡œì íŠ¸ ì´ë¦„ : (ììœ¨)  
>   ë°ì´í„° ì„œë²„ ì§€ì—­ : Korea-AWS-Seoul  
>   íƒ€ì„ ì¡´ : (GMT +9:00) Seoul, Tokyo, Yakutsk  


### ì¿ ë²„ë„¤í‹°ìŠ¤ ì—ì´ì „íŠ¸ ì„¤ì¹˜

í”„ë¡œì íŠ¸ ìƒì„±ì´ ì™„ë£Œë˜ë©´, ì¿ ë²„ë„¤í‹°ìŠ¤ ì—ì´ì „íŠ¸ ì„¤ì¹˜ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.

1. ì¿ ë²„ë„¤í‹°ìŠ¤ ëª¨ë‹ˆí„°ë§ í”„ë¡œì íŠ¸ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ í‚¤ë¥¼ ë°œê¸‰ë°›ê³  ë‹¤ìŒì„ ëˆ„ë¦…ë‹ˆë‹¤.

   ![img_3.png](img_3.png)

2. ì•„ë˜ ì´ë¯¸ì§€ì™€ ê°™ì´ ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.

   ![img_4.png](img_4.png)

3. ì¶”ê°€ ê¸°ëŠ¥ì€ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.

   ![img_5.png](img_5.png)

4. ì„¤ì¹˜ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ ë°›ê³  ë‹¤ìŒì„ ëˆ„ë¦…ë‹ˆë‹¤.

   ![img_6.png](img_6.png)

5. ì„¤ì¹˜ ê°€ì´ë“œì— ì•ˆë‚´ëœ ëª…ë ¹ì–´ë¥¼ ë³µì‚¬/ë¶™ì—¬ë„£ê¸°í•˜ì—¬ ì‹¤í–‰í•©ë‹ˆë‹¤. ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ ë‚˜ì˜¤ë©´ ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜ë¥¼ ë§ˆì¹œ ê²ƒ ì…ë‹ˆë‹¤.

   ![img_7.png](img_7.png)

:::tip ë‹¤ìš´ë¡œë“œ íŒŒì¼ì€ ê¸°ë³¸ì ìœ¼ë¡œ ì•„ë˜ ìœ„ì¹˜ì— ìˆìŠµë‹ˆë‹¤.  
windows - `C:\Users\{ì‚¬ìš©ìì´ë¦„}\Downloads\whatap_kube_agent.yaml`  
macOS - `/Users/{ì‚¬ìš©ìì´ë¦„}/Downloads/whatap_kube_agent.yaml`  
windows, macOS ëª¨ë‘ ê²½ë¡œ ì´ë™ ì‹œ `cd` ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ì´ë™í•©ë‹ˆë‹¤.
:::



### ë¡œê·¸ ëª¨ë‹ˆí„°ë§ í™œì„±í™”

1. ì¢Œì¸¡ ì‚¬ì´ë“œë°”ì˜ ë¡œê·¸ > ë¡œê·¸ ì„¤ì • ë©”ë‰´ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.
2. ì—ì´ì „íŠ¸ ì„¤ì • í™•ì¸ ë‹¨ê³„ì—ì„œ ë¡œê·¸ ì„¤ì • ì ìš©í•˜ê¸° ë²„íŠ¼ì„ í´ë¦­í•´ ë¡œê·¸ ìˆ˜ì§‘ì„ í™œì„±í™”í•´ì£¼ì„¸ìš”.

   ![img_8.png](img_8.png)

   ![img_9.png](img_9.png)

3. ë¡œê·¸ ëª¨ë‹ˆí„°ë§ í™œì„±í™” ë‹¨ê³„ì—ì„œ ë¡œê·¸ ëª¨ë‹ˆí„°ë§ì„ í™œì„±í™” í•´ì£¼ì„¸ìš”.

   ![img_10.png](img_10.png)


### ëª¨ë‹ˆí„°ë§ ì„¤ì¹˜ í™•ì¸

1. ëŒ€ì‹œë³´ë“œ > ì»¨í…Œì´ë„ˆ ë§µ ë©”ë‰´ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì˜¤ë¸Œì íŠ¸ê°€ ê´€ì°°ëœë‹¤ë©´ ëª¨ë‹ˆí„°ë§ì´ ì˜ ì„¤ì¹˜ëœ ê²ƒì…ë‹ˆë‹¤.

   <ì»¨í…Œì´ë„ˆ ë§µ ì§§ì€ ì„¤ëª…>

   ![img_11.png](img_11.png)

2. ìƒë‹¨ì˜ ê·¸ë£¹í™” ì˜µì…˜ì„ Namespaceë¡œ ì„ íƒí•˜ë©´ ì¿ ë²„ë„¤í‹°ìŠ¤ ëª¨ë‹ˆí„°ë§ì„ í•˜ëŠ” ì™€íƒ­ ì—ì´ì „íŠ¸ ì»¨í…Œì´ë„ˆê°€ whatap-monitoringì´ë¼ëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¡œ ë¶„ë¦¬ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

   ![img_12.png](img_12.png)


## ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬í•˜ê¸°

1. ë©”ëª¨ì¥ì„ ì¤€ë¹„í•©ë‹ˆë‹¤.
2. ê´€ë¦¬ > í”„ë¡œì íŠ¸ ê´€ë¦¬ ë©”ë‰´ë¡œ ì´ë™í•œ ë’¤, í”„ë¡œì íŠ¸ ì•¡ì„¸ìŠ¤ í‚¤ë¥¼ ë©”ëª¨ì¥ì— ë³µì‚¬í•´ì£¼ì„¸ìš”.

   ![img_13.png](img_13.png)

3. ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ë©”ëª¨ì¥ì— ë³µì‚¬í•´ì£¼ì„¸ìš”.

   > macOSëŠ” ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.
   >
   >
   > ```bash
    > curl -O https://raw.githubusercontent.com/whatap/k8s-edu-storage/master/k8s-object/hands-on-labs.yaml && sed -i '' 's/\${{LICENSEVALUE}}/ì´ê³³ì—í”„ë¡œì íŠ¸ì•¡ì„¸ìŠ¤í‚¤ë¥¼ë„£ì–´ì£¼ì„¸ìš”/g' hands-on-labs.yaml && kubectl apply -f hands-on-labs.yaml
    > ```
   >

   > WindowsëŠ” ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.
   >
   >
   > ```bash
    > Invoke-WebRequest -Uri "https://raw.githubusercontent.com/whatap/k8s-edu-storage/master/k8s-object/hands-on-labs.yaml" -OutFile "hands-on-labs.yaml"; (Get-Content -Path "hands-on-labs.yaml") -replace '\${{LICENSEVALUE}}', 'ì´ê³³ì—í”„ë¡œì íŠ¸ì•¡ì„¸ìŠ¤í‚¤ë¥¼ë„£ì–´ì£¼ì„¸ìš”' | Set-Content -Path "hands-on-labs.yaml"; kubectl apply -f hands-on-labs.yaml
    > ```
>
4. `ì´ê³³ì—í”„ë¡œì íŠ¸ì•¡ì„¸ìŠ¤í‚¤ë¥¼ë„£ì–´ì£¼ì„¸ìš”` ë¶€ë¶„ì„ ì´ì „ì— ë³µì‚¬í•´ë‘” í”„ë¡œì íŠ¸ ì•¡ì„¸ìŠ¤ í‚¤ë¡œ ìˆ˜ì •í•œ ë’¤ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

   ![img_14.png](img_14.png)

   ë°©ê¸ˆ ì ìš©í•œ yaml íŒŒì¼ì€ ì‹¤ì œë¡  ë‹¤ìŒê³¼ ê°™ì´ ìƒê²¼ìŠµë‹ˆë‹¤. ë§í¬ë¥¼ í†µí•´ì„œë„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<details>
    <summary>YAML ì „ì²´ë³´ê¸°</summary>

    apiVersion: v1
    kind: Namespace
    metadata:
      name: java
    ---
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: callee-with-db-deploy
      namespace: java
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: callee-with-db
      template:
        metadata:
          labels:
            app: callee-with-db
        spec:
          containers:
          - name: callee-with-db
            image: workirostub/demo:callee-with-db-1.0.9
            ports:
            - containerPort: 8080
            env:
            - name: JAVA_OPTION
              value: "-Dspring.profiles.active=prod"
            - name: DATASOURCE_URL
              value: "jdbc:postgresql://db-svc.java:5432/postgres"
            - name: DATASOURCE_USERNAME
              value: postgres
            - name: DATASOURCE_PASSWORD
              value: qwer1234
            - name: whatap.server.host
              value: "13.124.11.223/13.209.172.35"
            - name: whatap.micro.enabled
              value: "true"
            - name: weaving
              value: "spring-boot-3.0"
            - name: mtrace_rate
              value: "100"
            - name: mtrace_auto_enabled
              value: "false"
            - name: logsink_rt_enabled
              value: "true"
            - name: logsink_enabled
              value: "true"
            - name: NODE_IP
              valueFrom: {fieldRef: {fieldPath: status.hostIP}}
            - name: NODE_NAME
              valueFrom: {fieldRef: {fieldPath: spec.nodeName}}
            - name: POD_NAME
              valueFrom: {fieldRef: {fieldPath: metadata.name}}
            - name: OKIND
              value: hands-on-labs
            - name: license
              value: ${{LICENSEVALUE}}
    ---
    apiVersion: v1
    kind: Service
    metadata:
      name: callee-with-db-svc
      namespace: java
    spec:
      selector:
        app: callee-with-db
      ports:
        - protocol: TCP
          port: 8080
          targetPort: 8080
    ---
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: callee-deploy
      namespace: java
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: callee
      template:
        metadata:
          labels:
            app: callee
        spec:
          containers:
          - name: callee
            image: workirostub/demo:callee-1.0.9
            ports:
            - containerPort: 8080
            env:
            - name: JAVA_OPTION
              value: "-Dspring.profiles.active=prod"
            - name: CALLEE_WITH_DB_URL
              value: http://callee-with-db-svc.java:8080
            - name: whatap.server.host
              value: "13.124.11.223/13.209.172.35"
            - name: whatap.micro.enabled
              value: "true"
            - name: weaving
              value: "spring-boot-3.0"
            - name: mtrace_rate
              value: "100"
            - name: mtrace_auto_enabled
              value: "false"
            - name: logsink_rt_enabled
              value: "true"
            - name: logsink_enabled
              value: "true"
            - name: NODE_IP
              valueFrom: {fieldRef: {fieldPath: status.hostIP}}
            - name: NODE_NAME
              valueFrom: {fieldRef: {fieldPath: spec.nodeName}}
            - name: POD_NAME
              valueFrom: {fieldRef: {fieldPath: metadata.name}}
            - name: OKIND
              value: hands-on-labs
            - name: license
              value: ${{LICENSEVALUE}}
    ---
    apiVersion: v1
    kind: Service
    metadata:
      name: callee-svc
      namespace: java
    spec:
      selector:
        app: callee
      ports:
        - protocol: TCP
          port: 8080
          targetPort: 8080
    ---
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: caller-deploy
      namespace: java
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: caller
      template:
        metadata:
          labels:
            app: caller
        spec:
          containers:
          - name: caller
            image: workirostub/demo:caller-1.0.9
            ports:
            - containerPort: 8080
            env:
            - name: JAVA_OPTION
              value: "-Dspring.profiles.active=prod"
            - name: CALLEE_URL
              value: http://callee-svc.java:8080
            - name: whatap.server.host
              value: "13.124.11.223/13.209.172.35"
            - name: whatap.micro.enabled
              value: "true"
            - name: weaving
              value: "spring-boot-3.0"
            - name: mtrace_rate
              value: "100"
            - name: mtrace_auto_enabled
              value: "false"
            - name: logsink_rt_enabled
              value: "true"
            - name: logsink_enabled
              value: "true"
            - name: NODE_IP
              valueFrom: {fieldRef: {fieldPath: status.hostIP}}
            - name: NODE_NAME
              valueFrom: {fieldRef: {fieldPath: spec.nodeName}}
            - name: POD_NAME
              valueFrom: {fieldRef: {fieldPath: metadata.name}}
            - name: OKIND
              value: hands-on-labs
            - name: license
              value: ${{LICENSEVALUE}}
    ---
    apiVersion: v1
    kind: Service
    metadata:
      name: caller-svc
      namespace: java
    spec:
      type: NodePort
      selector:
        app: caller
      ports:
        - protocol: TCP
          port: 8080
          targetPort: 8080
          nodePort: 32100
    ---
    apiVersion: v1
    kind: Pod
    metadata:
      name: postgres
      namespace: java
      labels:
        app: db
    spec:
      restartPolicy: Always
      containers:
      - name: postgres
        image: postgres:12
        ports:
        - containerPort: 5432
        env:
        - name: POSTGRES_PASSWORD
          value: qwer1234
        - name: PGDATA
          value: /var/lib/postgresql/data/pgdata
      volumes:
        - name: data
          emptyDir:
            sizeLimit: 100Mi
    ---
    apiVersion: v1
    kind: Service
    metadata:
      name: db-svc
      namespace: java
    spec:
      selector:
        app: db
      ports:
        - protocol: TCP
          port: 5432
          targetPort: 5432
</details>

:::info
    ğŸ”— https://raw.githubusercontent.com/whatap/k8s-edu-storage/master/k8s-object/hands-on-labs.yaml
:::

5. ëŒ€ì‹œë³´ë“œ > ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ ëŒ€ì‹œë³´ë“œ ë©”ë‰´ì— ë“¤ì–´ê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°ì´í„°ê°€ ìˆ˜ì§‘ë˜ê³  ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

   ![img_15.png](img_15.png)

6. ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ minikube ì»¨í…Œì´ë„ˆ ë°–ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œí•©ë‹ˆë‹¤. (ì´ ëª…ë ¹ì„ ì‹¤í–‰ í›„ í„°ë¯¸ë„ì´ë‚˜ ì‰˜ì„ ë‹«ì§€ë§ˆì„¸ìš”!)

    ```bash
    minikube service -n java caller-svc --url
    ```

   ![img_16.png](img_16.png)

7. Chrome ì—ì„œ ìœ„ ëª…ë ¹ì„ ì³ì„œ ë‚˜ì˜¨ ì¶œë ¥ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì—¬ ì ‘ì†í•©ë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì´ ë‚˜ì˜¨ë‹¤ë©´ ì •ìƒì ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°°í¬ ëœ ê²ƒì…ë‹ˆë‹¤.

   ![img_17.png](img_17.png)


## ì• í”Œë¦¬ì¼€ì´ì…˜ ì‚´í´ë³´ê¸°

í˜„ì¬ ì„œë¹„ìŠ¤ëŠ” 3ê°œì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ 1ê°œì˜ DBë¡œ êµ¬ì„±ë˜ì–´ìˆìŠµë‹ˆë‹¤.

![img_18.png](img_18.png)

ê° ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì—­í• ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

| ì• í”Œë¦¬ì¼€ì´ì…˜ | ì—­í•  |
| --- | --- |
| caller | calleeë¥¼ í˜¸ì¶œí•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤. ìœ ì €ê°€ ì ‘ì†í•œ í™”ë©´ì€ callerê°€ ì„œë¹™í•œ í™”ë©´ì…ë‹ˆë‹¤. |
| callee | callerë¡œë¶€í„° í˜¸ì¶œ ë°›ìœ¼ë©°, callee-with-dbë¥¼ í˜¸ì¶œí•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤. calleeëŠ” ìì²´ì ìœ¼ë¡œ ë¡œì§ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. |
| callee-with-db | calleeë¡œë¶€í„° í˜¸ì¶œ ë°›ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ì— í•„ìš”í•œ ë¡œì§ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. |

ì¿ ë²„ë„¤í‹°ìŠ¤ì— ë°°í¬ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì‚¬ìš©ìì˜ ì»´í“¨í„°(ì¸í”„ë¼)ê¹Œì§€ì˜ êµ¬ì¡°ë„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

![img_19.png](img_19.png)

### ì‹¤ì œë¡œ ë°°í¬í•œ ì˜¤ë¸Œì íŠ¸ì˜ ê´€ê³„ë¥¼ íŒŒì•…í•´ë´…ì‹œë‹¤

`ì»¨í…Œì´ë„ˆ ë§µ > java ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê·¸ë£¹ ì„ íƒ > ìƒì„¸ ë³´ê¸° > ë¦¬ì†ŒìŠ¤ ê´€ê³„ ì„ íƒ`

![img_20.png](img_20.png)

### Podì˜ ìˆ˜ë¥¼ ì¦ê°€ì‹œì¼œ ë´…ì‹œë‹¤

Deploymentë¥¼ ìˆ˜ì •í•˜ì—¬ Pod ìˆ˜ë¥¼ ì¦ê°€ì‹œì¼œë´…ë‹ˆë‹¤. `scale` ì€ ëª…ë ¹í˜• ë°©ì‹ìœ¼ë¡œ Deployment, ReplicaSet ë“±ì˜ ì‚¬ì´ì¦ˆë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. `--replicas` ì˜µì…˜ì„ í†µí•´ ì‚¬ì´ì¦ˆë¥¼ ì§€ì •í•©ë‹ˆë‹¤.

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•œ ë’¤, ì»¨í…Œì´ë„ˆ ë§µì—ì„œ Deploymentë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê·¸ë£¹í•‘í•˜ì—¬ ì‚´í´ë´…ì‹œë‹¤. ë¬´ì—‡ì´ ë‹¬ë¼ì¡Œì„ê¹Œìš”?

```bash
kubectl scale -n java deploy/caller-deploy --replicas=3
```

![img_23.png](img_23.png)

before

![img_22.png](img_22.png)

after

### ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œì¼œë´…ì‹œë‹¤

#### ê° ê¸°ëŠ¥ ì‚´í´ë³´ê¸°

|   ê¸°ëŠ¥   |                 ì„¤ëª…                      |
| --- | --- |
| í—¬ìŠ¤ ì²´í¬ | callerê°€ calleeì˜ ìƒíƒœë¥¼ ì²´í¬í•˜ëŠ” apië¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.  |
| ë¡œê·¸ ìƒì„± | callerê°€ calleeë¥¼, calleeê°€ callee-with-dbì˜ ë¡œê·¸ ìƒì„± apië¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. |
| DB ëŠë¦¬ê²Œ | caller â†’ callee â†’ callee-with-db ìˆœìœ¼ë¡œ í˜¸ì¶œí•˜ë©° callee-with-dbì—ì„œ íŠ¸ëœì­ì…˜ì´ ë§¤ìš° ëŠë¦¬ê²Œ ì§„í–‰ë©ë‹ˆë‹¤. |
| CPU ë¶€í•˜ ìƒìŠ¹ | caller â†’ callee ìˆœìœ¼ë¡œ í˜¸ì¶œí•˜ë©° calleeì—ì„œ ë¬´ê±°ìš´ ì—°ì‚°ì´ ì˜¤ë«ë™ì•ˆ ì§„í–‰ë©ë‹ˆë‹¤. |

### í—¬ìŠ¤ ì²´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œì¼œë´…ì‹œë‹¤

- Podì˜ íŠ¸ë ˆì´ìŠ¤ì—” ì–´ë–¤ ì¼ì´ ë°œìƒí•˜ë‚˜ìš”?
    1. íˆíŠ¸ë§µì— ìˆ˜í–‰ëœ íŠ¸ëœì­ì…˜ì´ í‘œì‹œë©ë‹ˆë‹¤. í•´ë‹¹ íŠ¸ëœì­ì…˜ë“¤ì„ ë“œë˜ê·¸í•´ ìƒì„¸ ë‚´ìš©ì„ ì‚´í´ë³¼ê¹Œìš”?

       ![img_24.png](img_24.png)

    :::tip **íˆíŠ¸ë§µ, íŠ¸ëœì­ì…˜ì´ ë¬´ì—‡ì¸ê°€ìš”?**

       ì‚¬ìš©ìì˜ ìš”ì²­, í•œê±´ í•œê±´ì„ Requestë¼ê³  í•˜ê³ , ì´ Requestë¥¼ ì„œë²„ì—ì„œ ì²˜ë¦¬í•˜ê³  ì‚¬ìš©ìì—ê²Œ ì‘ë‹µí•˜ëŠ” ê³¼ì •ì„Â **íŠ¸ëœì­ì…˜**(**Transaction**)ì´ë¼ê³  ì •ì˜í•©ë‹ˆë‹¤. íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•œ ì‹œê°„ë§ˆë‹¤ ì‚¬ìš©ìì˜ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µ ì‹œê°„ì„ ì°¨íŠ¸ ìœ„ì— ì‚¬ê°í˜•ìœ¼ë¡œ í‘œí˜„í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì‚¬ìš©ìì˜ ìš”ì²­ì— ì •ìƒì ìœ¼ë¡œ ì‘ë‹µí–ˆëŠ”ì§€ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

       íˆíŠ¸ë§µ íŒ¨í„´ì„ í†µí•´ ì¥ì• ë¥¼ ë¶„ì„í•˜ëŠ” ë°©ë²•ì€ [ë‹¤ìŒ ë¬¸ì„œ](https://docs.whatap.io/best-practice-guides/about-apm-hitmap-class)ì—ì„œ ìì„¸í•˜ê²Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    :::

    2. ë“œë˜ê·¸í•œ êµ¬ê°„ì—ì„œ ë°œìƒí•œ ëª¨ë“  íŠ¸ëœì­ì…˜ ëª©ë¡ ì°½ì´ ëœ¨ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Mí‘œì‹œê°€ ë¶™ì–´ìˆëŠ” íŠ¸ëœì­ì…˜ì€ ë‹¤ë¥¸ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì—°ê³„ëœ íŠ¸ëœì­ì…˜(ë©€í‹° íŠ¸ëœì­ì…˜)ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

       /health íŠ¸ëœì­ì…˜ì„ í´ë¦­í•œ ë’¤, ë©€í‹° íŠ¸ëœì­ì…˜ íƒ­ì„ ë“¤ì–´ê°€ë³´ë©´ /healthê°€ /callee/healthë¥¼ í˜¸ì¶œí•˜ê³  ìˆëŠ”ê±¸ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

       ![img_25.png](img_25.png)

    3. /callee/health ë…¸ë“œë¥¼ í´ë¦­í•´ë³´ë©´ í•´ë‹¹ íŠ¸ëœì­ì…˜ì˜ ìƒì„¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¸ëœì­ì…˜ ë¡œê·¸ë¥¼ í™•ì¸í•´ë³¼ê¹Œìš”?

       ![img_26.png](img_26.png)

       calleeê°€ í˜¸ì¶œë˜ì—ˆë‹¤ëŠ” ë¡œê·¸ê°€ ë‚¨ì•„ìˆë„¤ìš”!


### ë¡œê·¸ ìƒì„± ë²„íŠ¼ì„ ëˆŒëŸ¬ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œì¼œë´…ë‹ˆë‹¤

- Podì˜ íŠ¸ë ˆì´ìŠ¤ì—” ì–´ë–¤ ì¼ì´ ë°œìƒí•˜ë‚˜ìš”?
    1. ì´ì „ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ë©€í‹° íŠ¸ëœì­ì…˜ì„ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤. ì´ë²ˆì—ëŠ” /log â†’ /callee/log â†’ /log/create â†’ DB ê¹Œì§€ì˜ í˜¸ì¶œì´ ì¼ì–´ë‚œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

       ![img_27.png](img_27.png)

    2. /log/create íŠ¸ëœì­ì…˜ ìƒì„¸ë¥¼ í™•ì¸í•´ë³¼ê¹Œìš”?

       ![img_28.png](img_28.png)

       DBì— ë¡œê·¸ê°€ ì¶”ê°€ë˜ì—ˆë„¤ìš”!

- Podì˜ ë¡œê·¸ì—” ì–´ë–¤ ì¼ì´ ë°œìƒí•˜ë‚˜ìš”?

  ë¬´ìŠ¨ ë¡œê·¸ë¥¼ ë´ì•¼í•˜ëŠ”ì§€ ëª°ìœ¼ê²ŸìŒ..


### DBì˜ ëŠë¦° ì¡°íšŒ ë°œìƒ

DB ëŠë¦¬ê²Œ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œì¼œë³´ê³  ì›ì¸ì„ ì¶”ì í•´ë´…ë‹ˆë‹¤.

- Podì˜ íŠ¸ë ˆì´ìŠ¤ì—” ì–´ë–¤ ì¼ì´ ë°œìƒí•˜ë‚˜ìš”?

  ì•¡í‹°ë¸Œ íŠ¸ëœì­ì…˜(ì‹¤í–‰ì¤‘ì¸ íŠ¸ëœì­ì…˜)ì˜ ìˆ˜ê°€ ëŠ˜ì–´ë‚˜ê³ , ì²˜ë¦¬ ì‹œê°„ ì—­ì‹œ verySlowì¸ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íˆíŠ¸ë§µ ì—­ì‹œ ì´ì „ê³¼ëŠ” ë‹¤ë¥´ê²Œ ë…¸ë€ìƒ‰, ë¹¨ê°„ìƒ‰ ì‚¬ê°í˜•ì´ ìœ„ìª½ì— ë¶„í¬ë˜ì–´ ìˆë„¤ìš”.

  ![img_29.png](img_29.png)

- ì™œ ëŠë¦°ì§€ í•œë²ˆ ì•Œì•„ë³´ë„ë¡ í•©ì‹œë‹¤
    1. ì´ë²ˆì—ëŠ” íˆíŠ¸ë§µì´ ì•„ë‹Œ ì•¡í‹°ë¸Œ íŠ¸ëœì­ì…˜ì„ í´ë¦­í•˜ì—¬ ì›ì¸ì„ ì°¾ì•„ë´…ì‹œë‹¤!

       ![img_30.png](img_30.png)

    2. ê²½ê³¼ ì‹œê°„ì´ ê°€ì¥ ê¸´ íŠ¸ëœì­ì…˜ ìˆœìœ¼ë¡œ í˜„ì¬ ì‹¤í–‰ì¤‘ì¸ íŠ¸ëœì­ì…˜ ëª©ë¡ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°€ì¥ ìƒë‹¨ì˜ íŠ¸ëœì­ì…˜ì„ í´ë¦­í•´ ìƒì„¸ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.

       ![img_31.png](img_31.png)

       `SELECT pg_sleep($)` ë¼ëŠ” ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ëŠ”ë° 8.5ì´ˆë‚˜ ê±¸ë ¸ë„¤ìš”. ë¹¨ë¦¬ ê°œë°œìë¥¼ ì°¾ì•„ê°€ì•¼ê² ìŠµë‹ˆë‹¤!


### CPU ë¶€í•˜ ë°œìƒ

CPU ë¶€í•˜ ìƒìŠ¹ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œì¼œë³´ê³  ì›ì¸ì„ ì¶”ì í•´ë´…ë‹ˆë‹¤.

- ì™œ CPUì˜ ë¶€í•˜ê°€ ìƒìŠ¹í–ˆì„ê¹Œìš”?

  ëª°ìœ¼ê²ŸìŒâ€¦ìë°” ë‚´ìš© ì£¼ë¥´ë¥µì¨ìˆëŠ”ê±¸ ë³´ë©´ ë˜ë‚˜ìš”? í•˜ì§€ë§Œ ê°œë°œì ì•„ë‹Œ ì…ì¥ì—ì„œë„ ì•Œ ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆë”°ë©´,,,ì–´ëŠ ìš”ì²­ì— ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë ¸ëŠ”ì§€


## ì •ë§ë¡œ ëª¨ë‹ˆí„°ë§ ì†”ë£¨ì…˜ì´ í•„ìš”í• ê¹Œ?

ìœ„ì— ìˆëŠ” ê²ƒë“¤ì€ ì§ì ‘ ì‰˜ë¡œ ì ‘ê·¼í•´ì„œ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ°ë° ì™œ ëª¨ë‹ˆí„°ë§ ì†”ë£¨ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ê±¸ê¹Œìš”?

- ì‹œê°ì ìœ¼ë¡œ ë°”ë¡œ íŒŒì•… í•  ìˆ˜ ìˆëŠ”ê°€?
- ì•Œë¦¼ì„ ì¦‰ê°ì ìœ¼ë¡œ ë°›ì„ ìˆ˜ ìˆëŠ”ê°€?
- ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ ì „ë°˜ì— ëŒ€í•œ ê´€ì°°ë ¥ì´ ìˆëŠ”ê°€?

---

# ë§ˆì¹˜ë©°

ëª¨ë‘ ê³ ìƒí•˜ì…¨ìŠµë‹ˆë‹¤. ë‹¤ìŒì€ ì‚¬ìš©í•œ ì™€íƒ­ ëª¨ë‹ˆí„°ë§ì˜ í”„ë¡œì íŠ¸ì™€ ì»´í“¨í„° ë‚´ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ì •ë¦¬í•˜ëŠ” ì‘ì—…ì…ë‹ˆë‹¤.

## ë¦¬ì†ŒìŠ¤ ì •ë¦¬

### windows

1. ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ minikube ì»¨í…Œì´ë„ˆë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.

    ```bash
    minikube stop & REM stops the VM
    minikube delete & REM deleted the VM
    ```

2. kubernetes ë””ë ‰í† ë¦¬ë¥¼ ì‚­ì œí•˜ì—¬ ì¿ ë²„ë„¤í‹°ìŠ¤ ê´€ë ¨ ì„¤ì • íŒŒì¼ì„ ì œê±°í•©ë‹ˆë‹¤.

   > ê²½ë¡œ 1 - C:\users\{user}\.minikube  
   > ê²½ë¡œ 2 -  C:\users\{user}\.kube â† ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ì´ ìˆë‹¤ë©´ ì§€ìš°ì§€ ë§ˆì„¸ìš”!


### macOS

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ minikube ì»¨í…Œì´ë„ˆë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.

```bash
minikube stop
minikube delete
```

## ì™€íƒ­ ëª¨ë‹ˆí„°ë§ í”„ë¡œì íŠ¸ ì œê±°

ê´€ë¦¬ > í”„ë¡œì íŠ¸ ê´€ë¦¬ ë©”ë‰´ì—ì„œ ìš°ì¸¡ í•˜ë‹¨ì˜ í”„ë¡œì íŠ¸ ì‚­ì œ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.

![img_32.png](img_32.png)

---








